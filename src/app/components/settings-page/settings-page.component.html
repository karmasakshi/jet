@let _lastUpdateCheckTimestamp = lastUpdateCheckTimestamp();
@let _settings = settings();

<ng-container *transloco="let t; prefix: 'jet-settings-page'">
  <jet-page
    [seoDescription]="t('seo.description')"
    [seoKeywords]="t('seo.keywords')"
    [seoTitle]="t('seo.title')"
    [toolbarTitle]="t('toolbar-title')"
  >
    <mat-card>
      <mat-card-content>
        <mat-action-list>
          <button
            mat-list-item
            type="button"
            [jetAnalytics]="{ name: 'open_language_options' }"
            [mat-menu-trigger-for]="languageOptionsMenu"
          >
            <mat-icon matListItemIcon>language</mat-icon>
            <span matListItemTitle>{{ t('change-language') }}</span>
            <span matListItemLine>{{
              _settings.languageOption.nameKey | transloco
            }}</span>
          </button>
          <button
            mat-list-item
            type="button"
            [jetAnalytics]="{ name: 'open_color_scheme_options' }"
            [mat-menu-trigger-for]="colorSchemeOptionsMenu"
          >
            <mat-icon matListItemIcon>palette</mat-icon>
            <span matListItemTitle>{{ t('change-color-scheme') }}</span>
            <span matListItemLine>{{
              _settings.colorSchemeOption.nameKey | transloco
            }}</span>
          </button>
          <button
            mat-list-item
            type="button"
            [jetAnalytics]="{ name: 'check_for_updates' }"
            (click)="checkForUpdate()"
          >
            <mat-icon matListItemIcon>sync</mat-icon>
            <span matListItemTitle>{{ t('check-for-updates') }}</span>
            <span matListItemLine>{{
              t('last-checked-x', {
                value: _lastUpdateCheckTimestamp | date: 'medium',
              })
            }}</span>
          </button>
          <button
            mat-list-item
            type="button"
            [jetAnalytics]="{ name: 'reload' }"
            (click)="reload()"
          >
            <mat-icon matListItemIcon>refresh</mat-icon>
            <span matListItemTitle>{{ t('reload') }}</span>
            <span matListItemLine>{{ t('reload-description') }}</span>
          </button>
          <button
            mat-list-item
            type="button"
            [jetAnalytics]="{ name: 'reset' }"
            (click)="reset()"
          >
            <mat-icon matListItemIcon>restart_alt</mat-icon>
            <span matListItemTitle>{{ t('reset') }}</span>
            <span matListItemLine>{{ t('reset-description') }}</span>
          </button>
        </mat-action-list>
      </mat-card-content>
    </mat-card>
    <p
      style="
        color: var(--mat-sys-on-surface-variant);
        font: var(--mat-sys-body-small);
        text-align: center;
      "
    >
      {{ t('version-x', { value: version }) }}
    </p>
    <mat-menu
      #languageOptionsMenu="matMenu"
      xPosition="before"
    >
      @for (languageOption of languageOptions; track languageOption.value) {
        <button
          mat-menu-item
          type="button"
          [disabled]="_settings.languageOption.value === languageOption.value"
          [jetAnalytics]="{
            data: { languageOption: languageOption.value },
            name: 'set_language_option',
          }"
          (click)="updateSettings({ languageOption })"
        >
          <mat-icon>{{ languageOption.icon }}</mat-icon>
          <span>{{ languageOption.nameKey | transloco }}</span>
        </button>
      }
    </mat-menu>
    <mat-menu
      #colorSchemeOptionsMenu="matMenu"
      xPosition="before"
    >
      @for (
        colorSchemeOption of colorSchemeOptions;
        track colorSchemeOption.value
      ) {
        <button
          mat-menu-item
          type="button"
          [disabled]="
            _settings.colorSchemeOption.value === colorSchemeOption.value
          "
          [jetAnalytics]="{
            data: { colorSchemeOption: colorSchemeOption.value },
            name: 'set_color_scheme_option',
          }"
          (click)="updateSettings({ colorSchemeOption })"
        >
          <mat-icon>{{ colorSchemeOption.icon }}</mat-icon>
          <span>{{ colorSchemeOption.nameKey | transloco }}</span>
        </button>
      }
    </mat-menu>
  </jet-page>
</ng-container>
