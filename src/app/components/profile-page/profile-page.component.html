<ng-container *transloco="let t">
  <jet-page
    [seoDescription]="t('jet-profile-page.seo.description')"
    [seoKeywords]="t('jet-profile-page.seo.keywords')"
    [seoTitle]="t('jet-profile-page.seo.title')"
    [toolbarTitle]="t('jet-profile-page.toolbar-title')"
  >
    @let _profile = profile();
    @if (_profile) {
      <div class="jet-flex-col-centered">
        <mat-card style="width: 100%; max-width: 480px">
          <img
            [alt]="t('jet-profile-page.profile')"
            height="180"
            mat-card-image
            ngSrc="./card.webp"
            priority
            width="480"
          />
          <mat-card-content>
            <mat-card
              [ngStyle]="{
                cursor: profileFormGroup.disabled ? 'not-allowed' : 'pointer',
              }"
              (click)="avatarInput.click()"
              matRipple
              style="
                border: 3px solid var(--mat-sys-surface-container-low);
                height: 132px;
                width: 132px;
                border-radius: 50%;
                margin: -84px auto 36px;
              "
            >
              <img
                [alt]="t('jet-profile-page.avatar')"
                [ngSrc]="
                  _profile.avatar_url ??
                  'https://placehold.co/128x128/webp?text=?'
                "
                height="128"
                priority
                style="object-fit: cover; object-position: center"
                width="128"
              />
              <mat-card-content style="display: none">
                <input
                  #avatarInput
                  [disabled]="profileFormGroup.disabled"
                  (change)="replaceAvatar()"
                  accept="image/*"
                  type="file"
                />
              </mat-card-content>
            </mat-card>
            <form
              id="profile-form"
              [formGroup]="profileFormGroup"
              (ngSubmit)="
                updateProfile({
                  username: profileFormGroup.controls.username.value ?? '',
                })
              "
            >
              <mat-form-field>
                <mat-label>{{ t('jet-profile-page.username') }}</mat-label>
                <input
                  autocomplete="off"
                  formControlName="username"
                  matInput
                  required
                  type="text"
                />
                @if (profileFormGroup.controls.username.dirty) {
                  <mat-hint align="end"
                    >{{
                      t('jet-profile-page.characters', {
                        maximum: 30,
                        value:
                          profileFormGroup.controls.username.value?.length || 0,
                      })
                    }}
                  </mat-hint>
                }
              </mat-form-field>
            </form>
          </mat-card-content>
          <mat-card-actions>
            <button
              [disabled]="
                profileFormGroup.disabled ||
                profileFormGroup.invalid ||
                profileFormGroup.pristine
              "
              form="profile-form"
              mat-flat-button
              type="submit"
            >
              <mat-icon>check</mat-icon>
              <span>{{ t('jet-profile-page.update-profile') }}</span>
            </button>
            <div style="flex: 1"></div>
            <a
              mat-button
              routerLink="/update-password"
            >
              <mat-icon>lock_reset</mat-icon>
              <span>{{ t('jet-profile-page.update-password') }}</span>
            </a>
          </mat-card-actions>
        </mat-card>
        <mat-card style="width: 100%; max-width: 480px">
          <mat-card-content>
            <div class="jet-flex-col-centered">
              <small
                ><b>{{ user()?.email }}</b></small
              >
              <small>{{
                t('jet-profile-page.profile-last-updated-on', {
                  value: _profile.updated_at | date: 'medium',
                })
              }}</small>
              <small>
                {{
                  t('jet-profile-page.profile-created-on', {
                    value: _profile.created_at | date: 'medium',
                  })
                }}
              </small>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    } @else {
      <div style="display: flex; justify-content: center">
        <mat-progress-spinner
          diameter="32"
          mode="indeterminate"
        ></mat-progress-spinner>
      </div>
    }
  </jet-page>
</ng-container>
